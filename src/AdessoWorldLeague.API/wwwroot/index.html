<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adesso World League â€” Kura Ã‡ekimi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            adesso: { DEFAULT: '#E30613', dark: '#b30010' }
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-gray-950 text-gray-100 font-sans">

  <!-- Header -->
  <header class="bg-gray-900 border-b border-gray-800 px-6 py-4 flex items-center gap-3">
    <span class="text-2xl">âš½</span>
    <div>
      <h1 class="text-lg font-bold text-white">Adesso World League</h1>
      <p class="text-xs text-gray-400">Grup Kura Ã‡ekimi</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-10 space-y-10">

    <!-- Draw Form -->
    <section class="bg-gray-900 rounded-2xl p-8 border border-gray-800 shadow-xl">
      <h2 class="text-xl font-semibold mb-6 text-white">Kura Bilgileri</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">

        <div class="space-y-1">
          <label class="text-sm text-gray-400">Ad</label>
          <input
            id="firstName"
            type="text"
            placeholder="Ahmet"
            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-adesso focus:border-transparent"
          />
        </div>

        <div class="space-y-1">
          <label class="text-sm text-gray-400">Soyad</label>
          <input
            id="lastName"
            type="text"
            placeholder="YÄ±lmaz"
            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-adesso focus:border-transparent"
          />
        </div>

        <div class="space-y-1">
          <label class="text-sm text-gray-400">Grup SayÄ±sÄ±</label>
          <select
            id="groupCount"
            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:ring-2 focus:ring-adesso focus:border-transparent"
          >
            <option value="8">8 Grup (4 takÄ±m/grup)</option>
            <option value="4">4 Grup (8 takÄ±m/grup)</option>
          </select>
        </div>
      </div>

      <button
        id="drawBtn"
        onclick="performDraw()"
        class="w-full md:w-auto bg-adesso hover:bg-adesso-dark transition-colors px-8 py-3 rounded-lg font-semibold text-white flex items-center gap-2 justify-center"
      >
        <span id="btnIcon">ğŸ²</span>
        <span id="btnText">KurayÄ± Ã‡ek</span>
      </button>

      <!-- Error -->
      <div id="errorBox" class="hidden mt-4 bg-red-900/40 border border-red-700 text-red-300 rounded-lg px-4 py-3 text-sm"></div>
    </section>

    <!-- Results -->
    <section id="resultsSection" class="hidden space-y-6">

      <!-- Meta info -->
      <div id="metaInfo" class="flex flex-wrap gap-4 text-sm text-gray-400">
      </div>

      <!-- Groups grid -->
      <div id="groupsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      </div>
    </section>

  </main>

  <script>
    const FLAGS = {
      'TÃ¼rkiye':  'ğŸ‡¹ğŸ‡·',
      'Almanya':  'ğŸ‡©ğŸ‡ª',
      'Fransa':   'ğŸ‡«ğŸ‡·',
      'Hollanda': 'ğŸ‡³ğŸ‡±',
      'Portekiz': 'ğŸ‡µğŸ‡¹',
      'Ä°talya':   'ğŸ‡®ğŸ‡¹',
      'Ä°spanya':  'ğŸ‡ªğŸ‡¸',
      'BelÃ§ika':  'ğŸ‡§ğŸ‡ª',
    };

    // Country name is embedded in the team name â€” extract it by looking up the known country list
    function getFlag(teamName) {
      for (const [country, flag] of Object.entries(FLAGS)) {
        const city = teamName.replace('Adesso ', '');
        const known = {
          'Ä°stanbul':'TÃ¼rkiye','Ankara':'TÃ¼rkiye','Ä°zmir':'TÃ¼rkiye','Antalya':'TÃ¼rkiye',
          'Berlin':'Almanya','Frankfurt':'Almanya','MÃ¼nih':'Almanya','Dortmund':'Almanya',
          'Paris':'Fransa','Marsilya':'Fransa','Nice':'Fransa','Lyon':'Fransa',
          'Amsterdam':'Hollanda','Rotterdam':'Hollanda','Lahey':'Hollanda','Eindhoven':'Hollanda',
          'Lisbon':'Portekiz','Porto':'Portekiz','Braga':'Portekiz','Coimbra':'Portekiz',
          'Roma':'Ä°talya','Milano':'Ä°talya','Venedik':'Ä°talya','Napoli':'Ä°talya',
          'Sevilla':'Ä°spanya','Madrid':'Ä°spanya','Barselona':'Ä°spanya','Granada':'Ä°spanya',
          'BrÃ¼ksel':'BelÃ§ika','Brugge':'BelÃ§ika','Gent':'BelÃ§ika','Anvers':'BelÃ§ika',
        };
        if (known[city]) return FLAGS[known[city]];
      }
      return 'ğŸ™ï¸';
    }

    const GROUP_COLORS = [
      'border-red-600',    // A
      'border-blue-600',   // B
      'border-green-600',  // C
      'border-yellow-600', // D
      'border-purple-600', // E
      'border-pink-600',   // F
      'border-orange-600', // G
      'border-teal-600',   // H
    ];

    async function performDraw() {
      const firstName = document.getElementById('firstName').value.trim();
      const lastName  = document.getElementById('lastName').value.trim();
      const groupCount = parseInt(document.getElementById('groupCount').value);

      const errorBox = document.getElementById('errorBox');
      const btn      = document.getElementById('drawBtn');
      const btnText  = document.getElementById('btnText');
      const btnIcon  = document.getElementById('btnIcon');

      // Reset
      errorBox.classList.add('hidden');
      errorBox.textContent = '';
      document.getElementById('resultsSection').classList.add('hidden');

      // Simple client-side check
      if (!firstName || !lastName) {
        showError('Ad ve soyad alanlarÄ± zorunludur.');
        return;
      }

      // Loading state
      btn.disabled = true;
      btnIcon.textContent = 'â³';
      btnText.textContent = 'Ã‡ekiliyor...';

      try {
        const res = await fetch('/api/draw', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ groupCount, drawerFirstName: firstName, drawerLastName: lastName })
        });

        const data = await res.json();

        if (!res.ok) {
          showError(data.error || 'Bir hata oluÅŸtu.');
          return;
        }

        renderResults(data);

      } catch (err) {
        showError('API\'ye baÄŸlanÄ±lamadÄ±. UygulamanÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin ol.');
      } finally {
        btn.disabled = false;
        btnIcon.textContent = 'ğŸ²';
        btnText.textContent = 'KurayÄ± Ã‡ek';
      }
    }

    function renderResults(data) {
      // Meta
      const drawn = new Date(data.drawnAt).toLocaleString('tr-TR');
      document.getElementById('metaInfo').innerHTML = `
        <span class="bg-gray-800 px-3 py-1 rounded-full">ğŸ§‘ KurayÄ± Ã‡eken: <strong class="text-white">${data.drawerName}</strong></span>
        <span class="bg-gray-800 px-3 py-1 rounded-full">ğŸ• ${drawn}</span>
        <span class="bg-gray-800 px-3 py-1 rounded-full">ğŸ“‹ ${data.groups.length} Grup</span>
      `;

      // Groups
      const grid = document.getElementById('groupsGrid');
      grid.innerHTML = '';

      data.groups.forEach((group, i) => {
        const colorClass = GROUP_COLORS[i] || 'border-gray-600';
        const card = document.createElement('div');
        card.className = `bg-gray-900 rounded-xl border-t-4 ${colorClass} p-4 shadow space-y-2 animate-fade`;

        const header = document.createElement('h3');
        header.className = 'text-lg font-bold text-white mb-3';
        header.textContent = `Grup ${group.groupName}`;
        card.appendChild(header);

        group.teams.forEach(team => {
          const row = document.createElement('div');
          row.className = 'flex items-center gap-2 text-sm text-gray-200 bg-gray-800 rounded-lg px-3 py-2';
          row.innerHTML = `<span>${getFlag(team.name)}</span><span>${team.name}</span>`;
          card.appendChild(row);
        });

        grid.appendChild(card);
      });

      document.getElementById('resultsSection').classList.remove('hidden');
      document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function showError(msg) {
      const box = document.getElementById('errorBox');
      box.textContent = 'âš ï¸ ' + msg;
      box.classList.remove('hidden');
    }
  </script>

</body>
</html>
